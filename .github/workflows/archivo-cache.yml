name: convertir-texto-a-json

on:
  push:
    branches:
      - feature/*

jobs:
  convertir-texto:
    runs-on: ubuntu-latest
    steps:
      - name: Definir contenido del JSON
        id: json-content
        run: |
          echo '{"name": "pipelines","activity": 3,"module": 2,"isRequired": false}' > temp.json
          echo "json_content=$(cat temp.json)" >> $GITHUB_OUTPUT

      - name: Calcular clave de cache
        id: huellaDigital
        run: |
          HASH=$(sha256sum temp.json | cut -d ' ' -f 1)
          echo "json_hash=$HASH" >> $GITHUB_OUTPUT

      - name: Restaurar caché del archivo JSON
        id: cache-json
        uses: actions/cache@v4
        with:
          path: archivo.json
          key: json-file-${{ steps.huellaDigital.outputs.json_hash }}

      - name: Generar archivo JSON (solo si no está en cache)
        if: steps.cache-json.outputs.cache-hit != 'true'
        uses: devops-actions/json-to-file@v1.0.0
        with:
          json: '${{ steps.json-content.outputs.json_content }}'
          filename: 'archivo.json'

      - name: Mostrar rutas
        run: |
          echo "Ruta del archivo JSON: ${{ github.workspace }}/archivo.json"
          echo "Ruta del directorio de trabajo: ${{ github.workspace }}"

      - name: Cargar artefacto
        uses: actions/upload-artifact@v4
        with:
          name: archivo-json
          path: archivo.json